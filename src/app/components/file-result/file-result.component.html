<div class="container" [ngSwitch]="getStatus()" [class.dark-mode]="isDarkTheme">

  <!-- Loading State -->
  <div *ngSwitchCase="'loading'" class="loading">
    <div class="spinner"></div>
    <p>{{ message }}</p>
  </div>

  <!-- Error State -->
  <div *ngSwitchCase="'error'" class="error">
    <h2>Error</h2>
    <p>{{ errorMessage }}</p>
    <button (click)="goHome()">Go Home</button>
    <button (click)="goBack()">Try Again</button>
  </div>

  <!-- Success State -->
  <div *ngSwitchCase="'done'" class="results">
    <!-- Header Row with Info and Buttons -->
    <div class="results-header">
      <div class="file-info">
        <span class="info-item"><strong>Project:</strong> {{ projectName }}</span>
        <span class="info-item"><strong>File:</strong> {{ fileName }}</span>
      </div>
      <div class="file-actions">
        <button *ngIf="!editing" (click)="downloadOutputFile()" class="btn btn-primary" [disabled]="isDownloading">
          <span class="btn-icon" *ngIf="!isDownloading">üì•</span>
          <span class="btn-icon" *ngIf="isDownloading">‚è≥</span>
          {{ isDownloading ? 'Downloading...' : 'Download Output' }}
        </button>
        <button *ngIf="!editing" (click)="downloadAllFiles()" class="btn btn-secondary" [disabled]="isDownloading">
          <span class="btn-icon" *ngIf="!isDownloading">üì¶</span>
          <span class="btn-icon" *ngIf="isDownloading">‚è≥</span>
          {{ isDownloading ? 'Downloading...' : 'Download All' }}
        </button>
        <button *ngIf="!editing" (click)="enterEditMode()" class="btn btn-secondary" [disabled]="isSaving">
          <span class="btn-icon">‚úèÔ∏è</span> Edit
        </button>

        <button *ngIf="editing" (click)="saveEdit()" class="btn btn-primary" [disabled]="isSaving">
          <span class="btn-icon" *ngIf="!isSaving">üíæ</span>
          <span class="btn-icon" *ngIf="isSaving">‚è≥</span>
          {{ isSaving ? 'Saving...' : 'Save' }}
        </button>
        <button *ngIf="editing" (click)="cancelEdit()" class="btn btn-secondary" [disabled]="isSaving">
          <span class="btn-icon">‚Ü©Ô∏è</span> Cancel
        </button>

      </div>
    </div>

    <!-- Table -->
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th *ngFor="let header of csvHeaders">{{ header }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of csvData; let i = index" [class.total-row]="row.__isTotalRow">
            <td *ngFor="let header of csvHeaders; let j = index">
              <ng-container *ngIf="editing && !row.__isTotalRow && j !== csvHeaders.length -1 && !isSaving">
                <input [(ngModel)]="csvData[i][header]" (ngModelChange)="onCellChange(i, header, $event)" />
              </ng-container>
              <ng-container *ngIf="!editing || row.__isTotalRow || j === csvHeaders.length -1 || isSaving">
                {{ row[header] }}
              </ng-container>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="actions">
      <button (click)="goBack()" class="btn-action">Upload New File</button>
      <button (click)="goHome()" class="btn-action">Go Home</button>
    </div>
  </div>

</div>
