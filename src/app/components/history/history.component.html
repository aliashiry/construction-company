<div class="history-container">
  <!-- Header Section -->
  <div class="history-header">
    <div class="header-content">
      <h1 class="history-title">
        <svg class="title-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        File History
      </h1>
      <p class="history-subtitle">View and download all your uploaded files</p>
    </div>
    <button class="refresh-btn" (click)="refreshHistory()" [disabled]="isLoading">
      <svg class="refresh-icon" [class.spinning]="isLoading" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
      </svg>
      Refresh
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p class="loading-text">Loading your file history...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoading && errorMessage" class="error-state">
    <svg class="error-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
    </svg>
    <h3 class="error-title">{{ errorMessage }}</h3>
    <button class="retry-btn" (click)="refreshHistory()">Try Again</button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && !errorMessage && fileHistory.length === 0" class="empty-state">
    <svg class="empty-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
    </svg>
    <h3 class="empty-title">No Files Found</h3>
    <p class="empty-text">You haven't uploaded any files yet. Start by uploading your first file!</p>
  </div>

  <!-- Table with Data -->
  <div *ngIf="!isLoading && !errorMessage && fileHistory.length > 0" class="table-wrapper">
    <div class="table-container">
      <table class="history-table">
        <thead>
          <tr>
            <th class="th-project">Project Name</th>
            <th class="th-input">Input File</th>
            <th class="th-output">Output File</th>
            <th class="th-view">View Result</th>
            <th class="th-notes">Notes</th>
            <th class="th-date">Date Created</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of fileHistory; let i = index" class="table-row" [class.even-row]="i % 2 === 0">
            <!-- Project Name Column -->
            <td class="td-project">
              <div class="project-cell">
                <svg class="project-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                </svg>
                <span class="project-name">{{ item.projectName }}</span>
              </div>
            </td>

            <!-- Input File Column -->
            <td class="td-input">
              <button class="download-btn input-download" (click)="downloadAllFiles(item.projectName, item.fileName)">
                <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
                <span class="btn-text">{{ item.fileName }}</span>
              </button>
            </td>

            <!-- Output File Column -->
            <td class="td-output">
              <button class="download-btn output-download" (click)="downloadOutputFile(item.projectName, item.fileName)">
                <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
                <span class="btn-text">{{ item.fileName }}_output</span>
              </button>
            </td>

            <!-- View Result Column (NEW) -->
            <td class="td-view">
              <button 
                class="view-result-btn" 
                (click)="viewFileResult(item.projectName, item.fileName)"
                [disabled]="loadingFileId === item.projectName + '_' + item.fileName"
              >
                <svg class="view-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
                <span class="btn-text">
                  {{ loadingFileId === item.projectName + '_' + item.fileName ? 'Loading...' : 'View' }}
                </span>
              </button>
            </td>

            <!-- Notes Column -->
            <td class="td-notes">
              <div class="notes-cell" *ngIf="item.notes">
                <svg class="notes-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
                </svg>
                <span class="notes-text">{{ item.notes }}</span>
              </div>
              <span class="no-notes" *ngIf="!item.notes">â€”</span>
            </td>

            <!-- Date Created Column -->
            <td class="td-date">
              <div class="date-cell">
                <svg class="date-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <span class="date-text">{{ formatDate(item.dateCreate!) }}</span>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Table Footer -->
    <div class="table-footer">
      <p class="footer-text">
        <strong>{{ fileHistory.length }}</strong> file(s) found
      </p>
    </div>
  </div>
</div>
