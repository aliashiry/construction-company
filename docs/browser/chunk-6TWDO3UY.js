import{a as U,b as D,c as k,d as E,e as z,f as L,g as T,h as W,i as V,j as A,k as R}from"./chunk-XRLA3ASG.js";import{a as q}from"./chunk-ML6OZONP.js";import{a as B}from"./chunk-LPWP3JNO.js";import"./chunk-3O4E2BZ4.js";import{d as I}from"./chunk-TDOBGSRY.js";import"./chunk-ZT6EOFWV.js";import{$ as S,$a as r,Ba as l,Ca as _,Jb as y,Kb as N,Ma as g,Ob as j,Pa as d,Ra as w,Sa as n,Ta as o,Ua as M,Xa as P,Ya as f,Za as p,a as v,ab as O,bb as m,db as u,eb as h,fb as b,ha as x,hb as F,ia as C}from"./chunk-WHKR5R2A.js";function Y(a,i){if(a&1&&(n(0,"div",29)(1,"div",30),M(2,"div",31),n(3,"span"),r(4),o()()()),a&2){let e=p();l(4),O(e.successMessage||"Uploading file, please wait...")}}function G(a,i){if(a&1&&(n(0,"div",32),r(1),o()),a&2){let e=p();l(),m(" ",e.errorMessage," ")}}function X(a,i){if(a&1&&(n(0,"div",33),r(1),o()),a&2){let e=p();l(),m(" ",e.successMessage," ")}}function J(a,i){a&1&&(n(0,"option",34),r(1,"-- Select project --"),o())}function K(a,i){if(a&1&&(n(0,"option",35),r(1),o()),a&2){let e=i.$implicit;d("value",e),l(),O(e)}}function Q(a,i){if(a&1){let e=P();n(0,"div",36)(1,"input",37),b("ngModelChange",function(c){x(e);let s=p();return h(s.fileStorage.ProjectName,c)||(s.fileStorage.ProjectName=c),C(c)}),o()()}if(a&2){let e=p();l(),u("ngModel",e.fileStorage.ProjectName),d("disabled",e.isLoading)}}function Z(a,i){if(a&1){let e=P();n(0,"div",38)(1,"div",39)(2,"span",40),r(3,"\u{1F4C4}"),o(),r(4),o(),n(5,"button",41),f("click",function(){x(e);let c=p();return C(c.removeFile())}),r(6," Remove "),o()()}if(a&2){let e=p();l(4),m(" ",e.fileStorage.FileName," "),l(),d("disabled",e.isLoading)}}var H=class a{constructor(i,e,t){this.uploadService=i;this.authService=e;this.router=t}fileStorage={UserID:123,ProjectName:"",FileName:"",InputFileData:null,Notes:""};isUploading=!1;isLoading=!1;pollingSubscription=null;csvData=[];csvHeaders=[];showResults=!1;selectedFileName="";errorMessage="";successMessage="";projects=[];selectedProject="";showOther=!1;ngOnInit(){let i=this.uploadService.getFileStorage();i&&(this.fileStorage=v({},i),this.selectedFileName=i.FileName);let e=this.authService.currentUserValue;e&&e.id&&(this.fileStorage.UserID=parseInt(e.id,10)||123,this.loadProjects())}ngOnDestroy(){this.stopPolling()}loadProjects(){this.fileStorage.UserID&&this.uploadService.getAllProjects(this.fileStorage.UserID).subscribe({next:i=>{this.projects=Array.isArray(i)?i:[],this.projects.includes("Other")||this.projects.push("Other"),this.fileStorage.ProjectName&&(this.projects.includes(this.fileStorage.ProjectName)?(this.selectedProject=this.fileStorage.ProjectName,this.showOther=!1):(this.selectedProject="Other",this.showOther=!0))},error:i=>console.error("Failed to load projects",i)})}onProjectSelect(i){i==="Other"?(this.showOther=!0,this.fileStorage.ProjectName=""):(this.showOther=!1,this.fileStorage.ProjectName=i)}onFileSelected(i){let e=i.target;e.files&&e.files.length>0&&(this.fileStorage.InputFileData=e.files[0],this.fileStorage.FileName=e.files[0].name,this.selectedFileName=e.files[0].name,this.uploadService.setFileStorage(this.fileStorage),this.errorMessage="")}removeFile(){this.fileStorage.InputFileData=null,this.fileStorage.FileName="",this.selectedFileName="",this.uploadService.clearFile()}submitForm(){if(this.errorMessage="",this.successMessage="",!this.fileStorage.InputFileData||!(this.fileStorage.InputFileData instanceof File)){this.errorMessage="Please select a valid file";return}if(!this.fileStorage.ProjectName||this.fileStorage.ProjectName.trim()===""){this.errorMessage="Please enter a project name";return}if(!this.selectedFileName||this.selectedFileName.trim()===""){this.errorMessage="Please enter a file name";return}this.fileStorage.FileName=this.selectedFileName,this.isLoading=!0,this.successMessage="Uploading file, please wait...",this.showResults=!1,this.csvData=[],this.csvHeaders=[],this.uploadService.submitToInput(this.fileStorage).subscribe({next:()=>{localStorage.setItem("lastFileOutput",JSON.stringify({userId:this.fileStorage.UserID,projectName:this.fileStorage.ProjectName,fileName:this.fileStorage.FileName})),this.successMessage="File uploaded successfully! Redirecting...",setTimeout(()=>{this.router.navigate(["/file-result"])},1e3)},error:i=>{console.error("Upload failed",i),this.isLoading=!1,this.errorMessage="Failed to upload file. Error: "+(i?.error?.message||i?.message||"Unknown error")}})}stopPolling(){this.pollingSubscription&&(this.pollingSubscription.unsubscribe(),this.pollingSubscription=null)}onSubmit(i){i.preventDefault(),this.submitForm()}resetForm(){this.fileStorage={UserID:this.fileStorage.UserID,ProjectName:"",FileName:"",InputFileData:null,Notes:""},this.selectedFileName="",this.csvData=[],this.csvHeaders=[],this.showResults=!1,this.errorMessage="",this.successMessage="",this.uploadService.clearFile()}goHome(){this.router.navigate(["/"])}static \u0275fac=function(e){return new(e||a)(_(B),_(q),_(I))};static \u0275cmp=S({type:a,selectors:[["app-upload-file"]],standalone:!0,features:[F],decls:57,vars:20,consts:[[1,"upload-page-wrapper"],[1,"upload-form-full-page"],[1,"form-container"],[1,"form-header"],[1,"highlight"],[1,"form-body"],["class","alert alert-info",4,"ngIf"],["class","alert alert-error",4,"ngIf"],["class","alert alert-success",4,"ngIf"],["id","uploadForm",3,"submit"],[1,"form-group"],["for","projectSelect"],[1,"required"],["id","projectSelect","name","projectSelect","required","",1,"form-control",3,"ngModelChange","ngModel","disabled"],["value","","disabled","","selected","",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["style","margin-top:12px;",4,"ngIf"],[1,"file-upload-wrapper"],["type","file","id","fileInput","accept",".dxf,.dwg",1,"file-upload-input",3,"change","disabled"],[1,"file-upload-icon"],[1,"file-upload-text"],["class","file-info",4,"ngIf"],[1,"help-text"],["for","fileName"],[1,"Optional"],["type","text","id","fileName","name","fileName","placeholder","Enter file name or it will be auto-filled",1,"form-control",3,"ngModelChange","ngModel","disabled"],["for","notes"],["id","notes","name","notes","placeholder","Add any additional notes or requirements...",1,"form-control",3,"ngModelChange","ngModel","disabled"],["type","submit","id","submitBtn",1,"btn-submit",3,"disabled"],[1,"alert","alert-info"],[1,"loading-inline"],[1,"spinner-small"],[1,"alert","alert-error"],[1,"alert","alert-success"],["value","","disabled","","selected",""],[3,"value"],[2,"margin-top","12px"],["type","text","id","projectName","name","projectName","placeholder","Enter new project name","required","",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"file-info"],[1,"file-name"],[1,"file-icon"],["type","button",1,"btn-remove",3,"click","disabled"]],template:function(e,t){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1"),r(5,"Upload "),n(6,"span",4),r(7,"Project Files"),o()(),n(8,"p"),r(9,"Share your DXF/DWG files with our engineering team"),o()(),n(10,"div",5),g(11,Y,5,1,"div",6)(12,G,2,1,"div",7)(13,X,2,1,"div",8),n(14,"form",9),f("submit",function(s){return t.onSubmit(s)}),n(15,"div",10)(16,"label",11),r(17," Project Name "),n(18,"span",12),r(19,"*"),o()(),n(20,"select",13),b("ngModelChange",function(s){return h(t.selectedProject,s)||(t.selectedProject=s),s}),f("ngModelChange",function(s){return t.onProjectSelect(s)}),g(21,J,2,0,"option",14)(22,K,2,2,"option",15),o(),g(23,Q,2,2,"div",16),o(),n(24,"div",10)(25,"label"),r(26," Upload File "),n(27,"span",12),r(28,"*"),o()(),n(29,"div",17)(30,"input",18),f("change",function(s){return t.onFileSelected(s)}),o(),n(31,"div",19),r(32,"\u{1F4C1}"),o(),n(33,"div",20)(34,"strong"),r(35,"Click to upload"),o(),r(36," or drag and drop"),M(37,"br"),n(38,"small"),r(39,"DXF or DWG files only"),o()()(),g(40,Z,7,2,"div",21),n(41,"div",22),r(42,"Maximum file size: 50MB"),o()(),n(43,"div",10)(44,"label",23),r(45," File Name"),n(46,"span",24),r(47,"(If you want to change the uploaded file name)"),o()(),n(48,"input",25),b("ngModelChange",function(s){return h(t.selectedFileName,s)||(t.selectedFileName=s),s}),o(),n(49,"small",22),r(50,"You can edit the file name before sending"),o()(),n(51,"div",10)(52,"label",26),r(53,"Notes (Optional)"),o(),n(54,"textarea",27),b("ngModelChange",function(s){return h(t.fileStorage.Notes,s)||(t.fileStorage.Notes=s),s}),o()(),n(55,"button",28),r(56),o()()()()()()),e&2&&(l(11),d("ngIf",t.isLoading),l(),d("ngIf",t.errorMessage&&!t.isLoading),l(),d("ngIf",t.successMessage&&!t.isLoading),l(7),u("ngModel",t.selectedProject),d("disabled",t.isLoading),l(),d("ngIf",!t.selectedProject),l(),d("ngForOf",t.projects),l(),d("ngIf",t.showOther),l(6),w("has-file",t.fileStorage.InputFileData)("disabled",t.isLoading),l(),d("disabled",t.isLoading),l(10),d("ngIf",t.fileStorage.InputFileData),l(8),u("ngModel",t.selectedFileName),d("disabled",t.isLoading),l(6),u("ngModel",t.fileStorage.Notes),d("disabled",t.isLoading),l(),d("disabled",t.isUploading||t.isLoading),l(),m(" ",t.isLoading?"Uploading...":"Upload Project Files"," "))},dependencies:[R,L,W,V,U,T,D,k,A,z,E,j,y,N],styles:["*[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box}body[_ngcontent-%COMP%]{font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);min-height:100vh;padding:40px 20px}.upload-page-wrapper[_ngcontent-%COMP%]{min-height:100vh;width:100%;display:flex;flex-direction:column}.upload-form-full-page[_ngcontent-%COMP%]{min-height:100vh;width:100%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);padding:20px}.form-container[_ngcontent-%COMP%]{width:100%;max-width:700px;background:#fff;border-radius:20px;box-shadow:0 20px 60px #0000001a;overflow:hidden}.results-full-page[_ngcontent-%COMP%]{min-height:100vh;width:100%;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);padding:40px 20px;display:flex;align-items:center;justify-content:center}.results-container[_ngcontent-%COMP%]{width:100%;max-width:1000px;background:#fff;border-radius:20px;box-shadow:0 20px 60px #0000001a;overflow:hidden;padding:40px}.results-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:30px}.results-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#1a1a2e;font-size:2rem;margin-bottom:10px;font-weight:700}.form-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1a1a2e,#16213e);color:#fff;padding:40px 30px;text-align:center}.form-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:10px;font-weight:700}.form-header[_ngcontent-%COMP%]   .highlight[_ngcontent-%COMP%]{color:#ff6b35}.form-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#b8bcc8;font-size:.95rem}.form-body[_ngcontent-%COMP%]{padding:40px 30px}.form-group[_ngcontent-%COMP%]{margin-bottom:28px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;color:#2c3e50;font-weight:600;font-size:.95rem}.form-group[_ngcontent-%COMP%]   span.Optional[_ngcontent-%COMP%]{margin-top:-10px;color:#64748b;font-size:.75rem;opacity:.9}.required[_ngcontent-%COMP%]{color:#ff6b35;margin-left:3px}.form-control[_ngcontent-%COMP%]{width:100%;padding:14px 16px;border:2px solid #e1e8ed;border-radius:10px;font-size:.95rem;transition:all .3s ease;background:#f8f9fa;font-family:inherit}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#ff6b35;background:#fff;box-shadow:0 0 0 3px #ff6b351a}.form-control[_ngcontent-%COMP%]:disabled{background:#e8eaed;cursor:not-allowed;color:#999}textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:100px}.file-upload-wrapper[_ngcontent-%COMP%]{position:relative;border:2px dashed #cbd5e0;border-radius:10px;padding:30px;text-align:center;background:#f8f9fa;transition:all .3s ease;cursor:pointer}.file-upload-wrapper[_ngcontent-%COMP%]:hover:not(:has(input:disabled)){border-color:#ff6b35;background:#fff5f2}.file-upload-wrapper.has-file[_ngcontent-%COMP%]{border-color:#ff6b35;background:#fff5f2}.file-upload-input[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;opacity:0;cursor:pointer}.file-upload-icon[_ngcontent-%COMP%]{font-size:3rem;color:#ff6b35;margin-bottom:15px}.file-upload-text[_ngcontent-%COMP%]{color:#64748b;font-size:.95rem}.file-upload-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#ff6b35;font-weight:600}.file-info[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;background:#fff;padding:15px;border-radius:8px;margin-top:15px;border:1px solid #e1e8ed}.file-name[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;color:#2c3e50;font-weight:500}.file-icon[_ngcontent-%COMP%]{color:#ff6b35;font-size:1.5rem}.btn-remove[_ngcontent-%COMP%]{background:#ef4444;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:.85rem;font-weight:600;transition:all .3s ease}.btn-remove[_ngcontent-%COMP%]:hover:not(:disabled){background:#dc2626;transform:translateY(-1px)}.btn-remove[_ngcontent-%COMP%]:disabled{background:#cbd5e0;cursor:not-allowed}.help-text[_ngcontent-%COMP%]{color:#64748b;font-size:.85rem;margin-top:8px}.alert[_ngcontent-%COMP%]{padding:14px 16px;border-radius:8px;margin-bottom:20px;font-size:.9rem;border-left:4px solid;direction:rtl;text-align:right}.alert-error[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b;border-left-color:#dc2626}.alert-success[_ngcontent-%COMP%]{background:#dcfce7;color:#166534;border-left-color:#22c55e}.btn-submit[_ngcontent-%COMP%]{width:100%;padding:16px;background:linear-gradient(135deg,#ff6b35,#f7931e);color:#fff;border:none;border-radius:10px;font-size:1.05rem;font-weight:700;cursor:pointer;transition:all .3s ease;margin-top:10px}.btn-submit[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 10px 25px #ff6b354d}.btn-submit[_ngcontent-%COMP%]:disabled{background:#cbd5e0;cursor:not-allowed;transform:none}.table-wrapper[_ngcontent-%COMP%]{overflow-x:auto;margin-bottom:30px;border-radius:10px;box-shadow:0 2px 10px #0000000d}.results-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.9rem}.results-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1a1a2e,#16213e);color:#fff}.results-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:15px;text-align:left;font-weight:600;border:1px solid #e1e8ed}.results-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 15px;border:1px solid #e1e8ed;color:#2c3e50}.results-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background:#f8f9fa}.results-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#f0f5ff}.results-actions[_ngcontent-%COMP%]{display:flex;gap:15px;flex-wrap:wrap}.btn-restart[_ngcontent-%COMP%], .btn-home[_ngcontent-%COMP%]{flex:1;min-width:200px;padding:14px;border:none;border-radius:10px;font-size:1rem;font-weight:700;cursor:pointer;transition:all .3s ease}.btn-restart[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ff6b35,#f7931e);color:#fff}.btn-restart[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 10px 25px #ff6b354d}.btn-home[_ngcontent-%COMP%]{background:#e5e7eb;color:#2c3e50}.btn-home[_ngcontent-%COMP%]:hover{background:#d1d5db;transform:translateY(-2px)}@media (max-width: 768px){.upload-form-full-page[_ngcontent-%COMP%], .results-full-page[_ngcontent-%COMP%]{padding:15px}.form-container[_ngcontent-%COMP%], .results-container[_ngcontent-%COMP%]{padding:20px}.form-header[_ngcontent-%COMP%]{padding:30px 20px}.form-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}.form-body[_ngcontent-%COMP%]{padding:20px}.results-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}.results-table[_ngcontent-%COMP%]{font-size:.8rem}.results-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .results-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 8px}.results-actions[_ngcontent-%COMP%]{flex-direction:column}.btn-restart[_ngcontent-%COMP%], .btn-home[_ngcontent-%COMP%]{width:100%}}.alert-info[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:15px;border-radius:5px;margin-bottom:20px}.loading-inline[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px;font-size:16px}.spinner-small[_ngcontent-%COMP%]{border:3px solid rgba(255,255,255,.3);border-top:3px solid white;border-radius:50%;width:30px;height:30px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.form-control[_ngcontent-%COMP%]:disabled, .btn-submit[_ngcontent-%COMP%]:disabled, .btn-remove[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;background-color:#e0e0e0}.file-upload-wrapper.disabled[_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed;pointer-events:none}"]})};export{H as UploadFileComponent};
