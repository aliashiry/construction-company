import{a as T}from"./chunk-QVDO5LVI.js";import"./chunk-APXEHMAM.js";import{d as I}from"./chunk-BJ5GJOCV.js";import{b as N}from"./chunk-CVU5FZDJ.js";import{$ as S,$a as l,Ba as d,Ca as b,Ib as k,Kb as E,L as M,Lb as R,Ma as x,N as P,Nb as D,Pa as g,Sa as r,Ta as o,Ua as y,Xa as C,Ya as f,Za as p,ab as _,bb as v,gb as F,ha as u,ia as m,y as w}from"./chunk-YJ3CRJMJ.js";function U(a,i){if(a&1&&(r(0,"div",4),y(1,"div",5),r(2,"p"),l(3),o()()),a&2){let e=p();d(3),_(e.message)}}function H(a,i){if(a&1){let e=C();r(0,"div",6)(1,"h2"),l(2,"Error"),o(),r(3,"p"),l(4),o(),r(5,"button",7),f("click",function(){u(e);let t=p();return m(t.goHome())}),l(6,"Go Home"),o(),r(7,"button",7),f("click",function(){u(e);let t=p();return m(t.goBack())}),l(8,"Try Again"),o()()}if(a&2){let e=p();d(4),_(e.errorMessage)}}function B(a,i){if(a&1&&(r(0,"th"),l(1),o()),a&2){let e=i.$implicit;d(),_(e)}}function z(a,i){if(a&1&&(r(0,"td"),l(1),o()),a&2){let e=i.$implicit,n=p().$implicit;d(),_(n[e])}}function A(a,i){if(a&1&&(r(0,"tr"),x(1,z,2,1,"td",17),o()),a&2){let e=p(2);d(),g("ngForOf",e.csvHeaders)}}function $(a,i){if(a&1){let e=C();r(0,"div",8)(1,"div",9)(2,"div",10)(3,"span",11)(4,"strong"),l(5,"Project:"),o(),l(6),o(),r(7,"span",11)(8,"strong"),l(9,"File:"),o(),l(10),o()(),r(11,"div",12)(12,"button",13),f("click",function(){u(e);let t=p();return m(t.downloadOutputFile())}),r(13,"span",14),l(14,"\u{1F4E5}"),o(),l(15," Download Output "),o(),r(16,"button",15),f("click",function(){u(e);let t=p();return m(t.downloadAllFiles())}),r(17,"span",14),l(18,"\u{1F4E6}"),o(),l(19," Download All "),o()()(),r(20,"div",16)(21,"table")(22,"thead")(23,"tr"),x(24,B,2,1,"th",17),o()(),r(25,"tbody"),x(26,A,2,1,"tr",17),o()()(),r(27,"div",18)(28,"button",19),f("click",function(){u(e);let t=p();return m(t.goBack())}),l(29,"Upload New File"),o(),r(30,"button",19),f("click",function(){u(e);let t=p();return m(t.goHome())}),l(31,"Go Home"),o()()()}if(a&2){let e=p();d(6),v(" ",e.projectName,""),d(4),v(" ",e.fileName,""),d(14),g("ngForOf",e.csvHeaders),d(2),g("ngForOf",e.csvData)}}var L=class a{constructor(i,e,n){this.http=i;this.router=e;this.uploadService=n}message="Processing data...";isLoading=!0;errorMessage="";csvData=[];csvHeaders=[];projectName="";fileName="";done=!1;pollingSubscription;maxPollingTime=6e5;pollingInterval=3e3;startTime=Date.now();ngOnInit(){this.startPolling()}ngOnDestroy(){this.pollingSubscription&&this.pollingSubscription.unsubscribe()}startPolling(){let i=localStorage.getItem("lastFileOutput");if(!i){this.errorMessage="No file data found. Please upload a file first.",this.isLoading=!1;return}let e;try{e=JSON.parse(i)}catch{this.errorMessage="Invalid file data. Please upload again.",this.isLoading=!1;return}let{userId:n,projectName:t,fileName:c}=e;if(this.projectName=t,this.fileName=c,!t||t.trim()===""){this.errorMessage="Project name is missing. Please upload again.",this.isLoading=!1;return}console.log("Starting polling with:",{userId:n,projectName:t,fileName:c}),this.message="Waiting for file processing...",this.pollingSubscription=w(this.pollingInterval).pipe(P(()=>Date.now()-this.startTime<this.maxPollingTime),M(()=>this.uploadService.checkOutputStatus(n,t,c))).subscribe({next:s=>{console.log("Polling response:",s),s.status==="Ready"?(this.done=!0,this.isLoading=!1,this.pollingSubscription?.unsubscribe(),this.fetchOutputFile(n,t,c)):s.status==="Processing"?this.message="File is still processing, please wait...":s.status==="NotFound"&&(this.pollingSubscription?.unsubscribe(),this.errorMessage="File record not found.",this.isLoading=!1)},error:s=>{console.error("Polling error:",s),this.pollingSubscription?.unsubscribe(),this.errorMessage="Error checking file status: "+(s?.error?.message||s?.message||"Unknown error"),this.isLoading=!1},complete:()=>{this.isLoading&&(this.errorMessage="File processing timeout. Please try again later.",this.isLoading=!1)}})}fetchOutputFile(i,e,n){this.isLoading=!0,this.message="Loading file data...",this.errorMessage="",this.uploadService.getOutputFileBase64(i,e,n).subscribe({next:t=>{if(console.log("BASE64 RESPONSE:",t),t?.fileBase64||t?.FileBase64){let c=t.fileBase64??t.FileBase64;this.processBase64ToCsv(c),this.message="File loaded successfully!",this.done=!0}else this.errorMessage="No file data found in server response.";this.isLoading=!1},error:t=>{console.error("Error fetching file:",t),this.errorMessage="Error fetching file from server.",this.isLoading=!1}})}processBase64ToCsv(i){try{let e=atob(i),n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);let c=new TextDecoder("utf-8").decode(n).trim().split(`
`);this.csvHeaders=c[0].split(",").map(s=>s.trim()),this.csvData=c.slice(1).map(s=>{let j=s.split(",").map(h=>h.trim()),O={};return this.csvHeaders.forEach((h,V)=>{O[h]=j[V]??""}),O})}catch(e){console.error("CSV decode error:",e),this.errorMessage="Error decoding CSV file."}}goBack(){this.router.navigate(["/upload"])}goHome(){this.router.navigate(["/"])}getStatus(){return this.errorMessage?"error":this.done?"done":"loading"}downloadOutputFile(){let i=localStorage.getItem("lastFileOutput");if(!i)return;let e=JSON.parse(i);this.uploadService.downloadOutputFile(e.userId,e.projectName,e.fileName).subscribe(n=>{let t=window.URL.createObjectURL(n),c=document.createElement("a");c.href=t,c.download=`${e.fileName}_output.csv`,c.click(),window.URL.revokeObjectURL(t)})}downloadAllFiles(){let i=localStorage.getItem("lastFileOutput");if(!i)return;let e=JSON.parse(i);this.uploadService.downloadAllFiles(e.userId,e.projectName,e.fileName).subscribe({next:n=>{let t=window.URL.createObjectURL(n),c=document.createElement("a");c.href=t,c.download=`${e.fileName}_all_files.zip`,c.click(),window.URL.revokeObjectURL(t)},error:n=>{console.error("Download all files error:",n),alert("Failed to download Input & Output files.")}})}static \u0275fac=function(e){return new(e||a)(b(N),b(I),b(T))};static \u0275cmp=S({type:a,selectors:[["app-file-result"]],standalone:!0,features:[F],decls:4,vars:4,consts:[[1,"container",3,"ngSwitch"],["class","loading",4,"ngSwitchCase"],["class","error",4,"ngSwitchCase"],["class","results",4,"ngSwitchCase"],[1,"loading"],[1,"spinner"],[1,"error"],[3,"click"],[1,"results"],[1,"results-header"],[1,"file-info"],[1,"info-item"],[1,"file-actions"],[1,"btn","btn-primary",3,"click"],[1,"btn-icon"],[1,"btn","btn-secondary",3,"click"],[1,"table-container"],[4,"ngFor","ngForOf"],[1,"actions"],[1,"btn-action",3,"click"]],template:function(e,n){e&1&&(r(0,"div",0),x(1,U,4,1,"div",1)(2,H,9,1,"div",2)(3,$,32,4,"div",3),o()),e&2&&(g("ngSwitch",n.getStatus()),d(),g("ngSwitchCase","loading"),d(),g("ngSwitchCase","error"),d(),g("ngSwitchCase","done"))},dependencies:[D,k,E,R],styles:[".container[_ngcontent-%COMP%]{padding:20px;max-width:1400px;margin:0 auto}.loading[_ngcontent-%COMP%]{text-align:center;padding:50px}.spinner[_ngcontent-%COMP%]{border:4px solid #f3f3f3;border-top:4px solid #3498db;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 20px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.error[_ngcontent-%COMP%]{text-align:center;padding:50px;color:#e74c3c}.error[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px}.error[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:10px;padding:10px 20px;border:none;border-radius:5px;background-color:#3498db;color:#fff;cursor:pointer}.error[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#2980b9}.results[_ngcontent-%COMP%]{padding:20px}.results-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:12px;margin-bottom:25px;box-shadow:0 4px 15px #667eea4d;flex-wrap:wrap;gap:15px}.file-info[_ngcontent-%COMP%]{display:flex;gap:30px;flex-wrap:wrap}.info-item[_ngcontent-%COMP%]{color:#fff;font-size:15px;display:flex;align-items:center;gap:8px}.info-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:600;opacity:.9}.file-actions[_ngcontent-%COMP%]{display:flex;gap:12px;flex-wrap:wrap}.btn[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:8px;color:#fff;cursor:pointer;font-size:14px;font-weight:500;transition:all .3s ease;display:flex;align-items:center;gap:8px;box-shadow:0 2px 8px #00000026}.btn-icon[_ngcontent-%COMP%]{font-size:16px}.btn-primary[_ngcontent-%COMP%]{background-color:#27ae60}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#229954;transform:translateY(-2px);box-shadow:0 4px 12px #27ae604d}.btn-secondary[_ngcontent-%COMP%]{background-color:#2980b9}.btn-secondary[_ngcontent-%COMP%]:hover{background-color:#21618c;transform:translateY(-2px);box-shadow:0 4px 12px #2980b94d}.table-container[_ngcontent-%COMP%]{overflow-x:auto;margin:20px 0;border-radius:12px;box-shadow:0 4px 20px #00000014;background:#fff}table[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0}thead[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;position:sticky;top:0;z-index:10}th[_ngcontent-%COMP%]{padding:16px;text-align:left;font-weight:600;font-size:14px;text-transform:uppercase;letter-spacing:.5px;border:none}th[_ngcontent-%COMP%]:first-child{border-top-left-radius:12px}th[_ngcontent-%COMP%]:last-child{border-top-right-radius:12px}td[_ngcontent-%COMP%]{padding:14px 16px;text-align:left;border-bottom:1px solid #e8e8e8;font-size:14px;color:#333}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:all .2s ease}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f8f9fa}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e3f2fd}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]:first-child{border-bottom-left-radius:12px}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]:last-child{border-bottom-right-radius:12px}.actions[_ngcontent-%COMP%]{margin-top:30px;text-align:center;display:flex;justify-content:center;gap:15px;flex-wrap:wrap}.btn-action[_ngcontent-%COMP%]{padding:12px 30px;border:2px solid #3498db;border-radius:8px;background-color:#fff;color:#3498db;cursor:pointer;font-size:16px;font-weight:500;transition:all .3s ease}.btn-action[_ngcontent-%COMP%]:hover{background-color:#3498db;color:#fff;transform:translateY(-2px);box-shadow:0 4px 12px #3498db4d}@media (max-width: 768px){.results-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.file-info[_ngcontent-%COMP%]{flex-direction:column;gap:10px}.file-actions[_ngcontent-%COMP%]{width:100%;justify-content:stretch}.btn[_ngcontent-%COMP%]{flex:1;justify-content:center}.table-container[_ngcontent-%COMP%]{font-size:12px}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px}}"]})};export{L as FileResultComponent};
