import{a as F}from"./chunk-3O4E2BZ4.js";import{b as n,c as h}from"./chunk-Y2WE23YX.js";import{R as b,W as g,r as m}from"./chunk-DYVC5MWC.js";var A=class l{constructor(t){this.http=t;window.uploadService=this}currentFile=null;currentData=null;API_BASE_URL=`${F.BASE_URL}/history`;setFileStorage(t){this.currentData=t,this.currentFile=t.InputFileData}getFileStorage(){return this.currentData??null}clearFile(){this.currentFile=null,this.currentData&&(this.currentData.InputFileData=null)}submitToInput(t,e){let r=new FormData;t.InputFileData&&r.append("inputFile",t.InputFileData,t.InputFileData.name);let s=new URLSearchParams({userId:t.UserID.toString(),projectName:t.ProjectName,fileName:t.FileName,notes:t.Notes||"",forwardUrl:"https://hetask15.app.n8n.cloud/webhook/upload-file-dxf"});return this.http.post(`${this.API_BASE_URL}/input?${s.toString()}`,r)}checkOutput(t,e,r){let s=new n().set("userId",t.toString()).set("projectName",e.trim()).set("fileName",r.trim());return this.http.get(`${this.API_BASE_URL}/output/base64`,{params:s})}getOutputFile(t,e,r){let s=new n().set("userId",t.toString()).set("projectName",e.trim()).set("fileName",r.trim());return this.http.get(`${this.API_BASE_URL}/output/base64`,{params:s})}checkOutputStatus(t,e,r){let s=new n().set("userId",t.toString()).set("projectName",e.trim()).set("fileName",r.trim());return this.http.get(`${this.API_BASE_URL}/output/status`,{params:s})}getOutputFileBase64(t,e,r){let s=e.trim(),i=r.trim();return console.log("\u{1F50D} getOutputFileBase64 called with:",{userId:t,cleanProjectName:s,cleanFileName:i,projectNameIsString:typeof e=="string"}),this.http.get(`${this.API_BASE_URL}/output/base64`,{params:{userId:t.toString(),projectName:s,fileName:i}})}downloadOutputFile(t,e,r){return this.http.get(`${this.API_BASE_URL}/output/download`,{params:{userId:t.toString(),projectName:e.trim(),fileName:r.trim()},responseType:"blob"})}downloadAllFiles(t,e,r){return this.http.get(`${this.API_BASE_URL}/download/all`,{params:{userId:t.toString(),projectName:e.trim(),fileName:r.trim()},responseType:"blob"})}saveOutputFile(t,e,r,s,i){let a=atob(i),c=new Array(a.length);for(let u=0;u<a.length;u++)c[u]=a.charCodeAt(u);let I=new Uint8Array(c),p=new Blob([I],{type:"text/csv"}),o=new FormData;return o.append("userId",t.toString()),o.append("projectName",r.trim()),o.append("fileName",s.trim()),o.append("outputFile",p,s),console.log("\u{1F4BE} Sending save request to API /history/output:",{url:`${this.API_BASE_URL}/output`,params:{userId:t,projectName:r,fileName:s},blob:p.type,blobSize:p.size}),this.http.post(`${this.API_BASE_URL}/output`,o)}getFilesByProject(t,e){let r=new n().set("userId",t.toString()).set("projectName",e);return this.http.get(`${this.API_BASE_URL}/files/by-project`,{params:r})}saveOutputFileFormData(t,e,r,s,i){let a=new FormData;return a.append("userId",t.toString()),a.append("managerId",e.toString()),a.append("projectName",r.trim()),a.append("fileName",s.trim()),a.append("outputFile",i,s),console.log("\u{1F4BE} Sending FormData save request to API:",{url:`${this.API_BASE_URL}/output`,params:{userId:t,managerId:e,projectName:r,fileName:s}}),this.http.post(`${this.API_BASE_URL}/output`,a)}getFullFileData(t){let e=new n().set("userId",t.toString());return this.http.get(`${this.API_BASE_URL}/files/full-data`,{params:e})}getFullFileData2(t,e){let r=new n().set("userId",t.toString()).set("projectName",e);return this.http.get(`${this.API_BASE_URL}/files`,{params:r})}getAllProjects(t){let e=new n().set("userId",t.toString());return this.http.get(`${this.API_BASE_URL}/projects`,{params:e})}getProjectsCount(t){let e=new n().set("userId",t.toString());return this.http.get(`${this.API_BASE_URL}/projects`,{params:e})}getFilesCountByProject(t,e){let r=new n().set("userId",t.toString());return this.http.get(`${this.API_BASE_URL}/projects/count`,{params:r}).pipe(m(s=>s.projectCount))}getFilesCount(t){let e=new n().set("userId",t.toString());return this.http.get(`${this.API_BASE_URL}/files/totalcount`,{params:e}).pipe(m(r=>r.fileCount))}static \u0275fac=function(e){return new(e||l)(g(h))};static \u0275prov=b({token:l,factory:l.\u0275fac,providedIn:"root"})};export{A as a};
