import{a as H}from"./chunk-6JAEQWU2.js";import{a as q}from"./chunk-YI4JNLHC.js";import{a as B}from"./chunk-XYY33K7W.js";import{a as I,b as U,c as D,d as E,e as T,f as z,g as L,h as W,i as V,j as A,k as R}from"./chunk-P74VB2NW.js";import"./chunk-3O4E2BZ4.js";import{h as j}from"./chunk-XJODJNO7.js";import{$ as w,$a as r,Ba as l,Ca as g,Jb as y,Kb as k,Ma as f,Pa as s,Pb as N,Ra as P,Sa as n,Ta as i,Ua as x,Xa as O,Ya as m,Za as p,a as S,ab as v,bb as u,db as h,eb as b,fb as _,ha as C,hb as F,ia as M}from"./chunk-THL5O2XT.js";function G(a,o){if(a&1&&(n(0,"div",29)(1,"div",30),x(2,"div",31),n(3,"span"),r(4),i()()()),a&2){let e=p();l(4),v(e.successMessage||"Uploading file, please wait...")}}function X(a,o){if(a&1&&(n(0,"div",32),r(1),i()),a&2){let e=p();l(),u(" ",e.errorMessage," ")}}function J(a,o){if(a&1&&(n(0,"div",33),r(1),i()),a&2){let e=p();l(),u(" ",e.successMessage," ")}}function K(a,o){a&1&&(n(0,"option",34),r(1,"-- Select project --"),i())}function Q(a,o){if(a&1&&(n(0,"option",35),r(1),i()),a&2){let e=o.$implicit;s("value",e),l(),v(e)}}function Z(a,o){if(a&1){let e=O();n(0,"div",36)(1,"input",37),_("ngModelChange",function(c){C(e);let d=p();return b(d.fileStorage.ProjectName,c)||(d.fileStorage.ProjectName=c),M(c)}),i()()}if(a&2){let e=p();l(),h("ngModel",e.fileStorage.ProjectName),s("disabled",e.isLoading)}}function $(a,o){if(a&1){let e=O();n(0,"div",38)(1,"div",39)(2,"span",40),r(3,"\u{1F4C4}"),i(),r(4),i(),n(5,"button",41),m("click",function(){C(e);let c=p();return M(c.removeFile())}),r(6," Remove "),i()()}if(a&2){let e=p();l(4),u(" ",e.fileStorage.FileName," "),l(),s("disabled",e.isLoading)}}var Y=class a{constructor(o,e,t,c){this.uploadService=o;this.authService=e;this.router=t;this.themeService=c}fileStorage={UserID:0,ProjectName:"",FileName:"",InputFileData:null,Notes:""};isUploading=!1;isLoading=!1;pollingSubscription=null;csvData=[];csvHeaders=[];showResults=!1;selectedFileName="";errorMessage="";successMessage="";projects=[];selectedProject="";showOther=!1;ngOnInit(){let o=this.uploadService.getFileStorage();o&&(this.fileStorage=S({},o),this.selectedFileName=o.FileName);let e=this.authService.currentUserValue;e&&e.id&&(this.fileStorage.UserID=parseInt(e.id,10)||123,this.loadProjects())}ngOnDestroy(){this.stopPolling()}loadProjects(){this.fileStorage.UserID&&this.uploadService.getAllProjects(this.fileStorage.UserID).subscribe({next:o=>{this.projects=Array.isArray(o)?o:[],this.projects.includes("Other")||this.projects.push("Other"),this.fileStorage.ProjectName&&(this.projects.includes(this.fileStorage.ProjectName)?(this.selectedProject=this.fileStorage.ProjectName,this.showOther=!1):(this.selectedProject="Other",this.showOther=!0))},error:o=>console.error("Failed to load projects",o)})}onProjectSelect(o){o==="Other"?(this.showOther=!0,this.fileStorage.ProjectName=""):(this.showOther=!1,this.fileStorage.ProjectName=o)}onFileSelected(o){let e=o.target;e.files&&e.files.length>0&&(this.fileStorage.InputFileData=e.files[0],this.fileStorage.FileName=e.files[0].name,this.selectedFileName=e.files[0].name,this.uploadService.setFileStorage(this.fileStorage),this.errorMessage="")}removeFile(){this.fileStorage.InputFileData=null,this.fileStorage.FileName="",this.selectedFileName="",this.uploadService.clearFile()}submitForm(){if(this.errorMessage="",this.successMessage="",localStorage.removeItem("lastFileOutput"),!this.fileStorage.InputFileData||!(this.fileStorage.InputFileData instanceof File)){this.errorMessage="Please select a valid file";return}if(!this.fileStorage.ProjectName||this.fileStorage.ProjectName.trim()===""){this.errorMessage="Please enter a project name";return}if(!this.selectedFileName||this.selectedFileName.trim()===""){this.errorMessage="Please enter a file name";return}this.fileStorage.FileName=this.selectedFileName,this.isLoading=!0,this.successMessage="Uploading file, please wait...",this.showResults=!1,this.csvData=[],this.csvHeaders=[],this.uploadService.submitToInput(this.fileStorage).subscribe({next:()=>{localStorage.setItem("lastFileOutput",JSON.stringify({userId:this.fileStorage.UserID,projectName:this.fileStorage.ProjectName,fileName:this.fileStorage.FileName})),this.successMessage="File uploaded successfully! Redirecting...",setTimeout(()=>{this.router.navigate(["/file-result"])},1e3)},error:o=>{console.error("Upload failed",o),this.isLoading=!1,this.errorMessage="Failed to upload file. Error: "+(o?.error?.message||o?.message||"Unknown error")}})}stopPolling(){this.pollingSubscription&&(this.pollingSubscription.unsubscribe(),this.pollingSubscription=null)}onSubmit(o){o.preventDefault(),this.submitForm()}resetForm(){this.fileStorage={UserID:this.fileStorage.UserID,ProjectName:"",FileName:"",InputFileData:null,Notes:""},this.selectedFileName="",this.csvData=[],this.csvHeaders=[],this.showResults=!1,this.errorMessage="",this.successMessage="",this.uploadService.clearFile()}goHome(){this.router.navigate(["/"])}static \u0275fac=function(e){return new(e||a)(g(B),g(q),g(j),g(H))};static \u0275cmp=w({type:a,selectors:[["app-upload-file"]],standalone:!0,features:[F],decls:57,vars:22,consts:[[1,"upload-page-wrapper"],[1,"upload-form-full-page"],[1,"form-container"],[1,"form-header"],[1,"highlight"],[1,"form-body"],["class","alert alert-info",4,"ngIf"],["class","alert alert-error",4,"ngIf"],["class","alert alert-success",4,"ngIf"],["id","uploadForm",3,"submit"],[1,"form-group"],["for","projectSelect"],[1,"required"],["id","projectSelect","name","projectSelect","required","",1,"form-control",3,"ngModelChange","ngModel","disabled"],["value","","disabled","","selected","",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["style","margin-top:12px;",4,"ngIf"],[1,"file-upload-wrapper"],["type","file","id","fileInput","accept",".dxf,.dwg",1,"file-upload-input",3,"change","disabled"],[1,"file-upload-icon"],[1,"file-upload-text"],["class","file-info",4,"ngIf"],[1,"help-text"],["for","fileName"],[1,"Optional"],["type","text","id","fileName","name","fileName","placeholder","Enter file name or it will be auto-filled",1,"form-control",3,"ngModelChange","ngModel","disabled"],["for","notes"],["id","notes","name","notes","placeholder","Add any additional notes or requirements...",1,"form-control",3,"ngModelChange","ngModel","disabled"],["type","submit","id","submitBtn",1,"btn-submit",3,"disabled"],[1,"alert","alert-info"],[1,"loading-inline"],[1,"spinner-small"],[1,"alert","alert-error"],[1,"alert","alert-success"],["value","","disabled","","selected",""],[3,"value"],[2,"margin-top","12px"],["type","text","id","projectName","name","projectName","placeholder","Enter new project name","required","",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"file-info"],[1,"file-name"],[1,"file-icon"],["type","button",1,"btn-remove",3,"click","disabled"]],template:function(e,t){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1"),r(5,"Upload "),n(6,"span",4),r(7,"Project Files"),i()(),n(8,"p"),r(9,"Share your DXF/DWG files with our engineering team"),i()(),n(10,"div",5),f(11,G,5,1,"div",6)(12,X,2,1,"div",7)(13,J,2,1,"div",8),n(14,"form",9),m("submit",function(d){return t.onSubmit(d)}),n(15,"div",10)(16,"label",11),r(17," Project Name "),n(18,"span",12),r(19,"*"),i()(),n(20,"select",13),_("ngModelChange",function(d){return b(t.selectedProject,d)||(t.selectedProject=d),d}),m("ngModelChange",function(d){return t.onProjectSelect(d)}),f(21,K,2,0,"option",14)(22,Q,2,2,"option",15),i(),f(23,Z,2,2,"div",16),i(),n(24,"div",10)(25,"label"),r(26," Upload File "),n(27,"span",12),r(28,"*"),i()(),n(29,"div",17)(30,"input",18),m("change",function(d){return t.onFileSelected(d)}),i(),n(31,"div",19),r(32,"\u{1F4C1}"),i(),n(33,"div",20)(34,"strong"),r(35,"Click to upload"),i(),r(36," or drag and drop"),x(37,"br"),n(38,"small"),r(39,"DXF or DWG files only"),i()()(),f(40,$,7,2,"div",21),n(41,"div",22),r(42,"Maximum file size: 50MB"),i()(),n(43,"div",10)(44,"label",23),r(45," File Name"),n(46,"span",24),r(47,"(If you want to change the uploaded file name)"),i()(),n(48,"input",25),_("ngModelChange",function(d){return b(t.selectedFileName,d)||(t.selectedFileName=d),d}),i(),n(49,"small",22),r(50,"You can edit the file name before sending"),i()(),n(51,"div",10)(52,"label",26),r(53,"Notes (Optional)"),i(),n(54,"textarea",27),_("ngModelChange",function(d){return b(t.fileStorage.Notes,d)||(t.fileStorage.Notes=d),d}),i()(),n(55,"button",28),r(56),i()()()()()()),e&2&&(P("dark-mode",t.themeService.isDarkTheme()),l(11),s("ngIf",t.isLoading),l(),s("ngIf",t.errorMessage&&!t.isLoading),l(),s("ngIf",t.successMessage&&!t.isLoading),l(7),h("ngModel",t.selectedProject),s("disabled",t.isLoading),l(),s("ngIf",!t.selectedProject),l(),s("ngForOf",t.projects),l(),s("ngIf",t.showOther),l(6),P("has-file",t.fileStorage.InputFileData)("disabled",t.isLoading),l(),s("disabled",t.isLoading),l(10),s("ngIf",t.fileStorage.InputFileData),l(8),h("ngModel",t.selectedFileName),s("disabled",t.isLoading),l(6),h("ngModel",t.fileStorage.Notes),s("disabled",t.isLoading),l(),s("disabled",t.isUploading||t.isLoading),l(),u(" ",t.isLoading?"Uploading...":"Upload Project Files"," "))},dependencies:[R,z,W,V,I,L,U,D,A,T,E,N,y,k],styles:[".dark-mode[_ngcontent-%COMP%]   .upload-form-full-page[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0f172a,#1e293b)}.dark-mode[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]{background:#1e293b;box-shadow:0 20px 60px #0006}.dark-mode[_ngcontent-%COMP%]   .form-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0f172a,#16213e)}.dark-mode[_ngcontent-%COMP%]   .form-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#f1f5f9}.dark-mode[_ngcontent-%COMP%]   .form-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#94a3b8}.dark-mode[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#cbd5e1}.dark-mode[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{background:#2d3748;border-color:#4a5568;color:#f1f5f9}.dark-mode[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{background:#2d3748;border-color:#f97316;box-shadow:0 0 0 3px #f9731633}.dark-mode[_ngcontent-%COMP%]   .file-upload-wrapper[_ngcontent-%COMP%]{background:#2d3748;border-color:#4a5568}.dark-mode[_ngcontent-%COMP%]   .file-upload-wrapper[_ngcontent-%COMP%]:hover:not(:has(input:disabled)){background:#3c4a5f;border-color:#f97316}.dark-mode[_ngcontent-%COMP%]   .file-upload-text[_ngcontent-%COMP%]{color:#94a3b8}.dark-mode[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]{background:#2d3748;border-color:#4a5568}.dark-mode[_ngcontent-%COMP%]   .file-name[_ngcontent-%COMP%]{color:#f1f5f9}.dark-mode[_ngcontent-%COMP%]   .help-text[_ngcontent-%COMP%]{color:#94a3b8}.dark-mode[_ngcontent-%COMP%]   .btn-home[_ngcontent-%COMP%]{background:#4a5568;color:#f1f5f9}.dark-mode[_ngcontent-%COMP%]   .btn-home[_ngcontent-%COMP%]:hover{background:#5a6678}*[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box}body[_ngcontent-%COMP%]{font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);min-height:100vh;padding:40px 20px}.upload-page-wrapper[_ngcontent-%COMP%]{min-height:100vh;width:100%;display:flex;flex-direction:column}.upload-form-full-page[_ngcontent-%COMP%]{min-height:100vh;width:100%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);padding:20px}.form-container[_ngcontent-%COMP%]{width:100%;max-width:700px;background:#fff;border-radius:20px;box-shadow:0 20px 60px #0000001a;overflow:hidden}.results-full-page[_ngcontent-%COMP%]{min-height:100vh;width:100%;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);padding:40px 20px;display:flex;align-items:center;justify-content:center}.results-container[_ngcontent-%COMP%]{width:100%;max-width:1000px;background:#fff;border-radius:20px;box-shadow:0 20px 60px #0000001a;overflow:hidden;padding:40px}.results-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:30px}.results-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#1a1a2e;font-size:2rem;margin-bottom:10px;font-weight:700}.form-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1a1a2e,#16213e);color:#fff;padding:40px 30px;text-align:center}.form-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:10px;font-weight:700}.form-header[_ngcontent-%COMP%]   .highlight[_ngcontent-%COMP%]{color:#ff6b35}.form-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#b8bcc8;font-size:.95rem}.form-body[_ngcontent-%COMP%]{padding:40px 30px}.form-group[_ngcontent-%COMP%]{margin-bottom:28px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;color:#2c3e50;font-weight:600;font-size:.95rem}.form-group[_ngcontent-%COMP%]   span.Optional[_ngcontent-%COMP%]{margin-top:-10px;color:#64748b;font-size:.75rem;opacity:.9}.required[_ngcontent-%COMP%]{color:#ff6b35;margin-left:3px}.form-control[_ngcontent-%COMP%]{width:100%;padding:14px 16px;border:2px solid #e1e8ed;border-radius:10px;font-size:.95rem;transition:all .3s ease;background:#f8f9fa;font-family:inherit}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#ff6b35;background:#fff;box-shadow:0 0 0 3px #ff6b351a}.form-control[_ngcontent-%COMP%]:disabled{background:#e8eaed;cursor:not-allowed;color:#999}textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:100px}.file-upload-wrapper[_ngcontent-%COMP%]{position:relative;border:2px dashed #cbd5e0;border-radius:10px;padding:30px;text-align:center;background:#f8f9fa;transition:all .3s ease;cursor:pointer}.file-upload-wrapper[_ngcontent-%COMP%]:hover:not(:has(input:disabled)){border-color:#ff6b35;background:#fff5f2}.file-upload-wrapper.has-file[_ngcontent-%COMP%]{border-color:#ff6b35;background:#fff5f2}.file-upload-input[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;opacity:0;cursor:pointer}.file-upload-icon[_ngcontent-%COMP%]{font-size:3rem;color:#ff6b35;margin-bottom:15px}.file-upload-text[_ngcontent-%COMP%]{color:#64748b;font-size:.95rem}.file-upload-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#ff6b35;font-weight:600}.file-info[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;background:#fff;padding:15px;border-radius:8px;margin-top:15px;border:1px solid #e1e8ed}.file-name[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;color:#2c3e50;font-weight:500}.file-icon[_ngcontent-%COMP%]{color:#ff6b35;font-size:1.5rem}.btn-remove[_ngcontent-%COMP%]{background:#ef4444;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:.85rem;font-weight:600;transition:all .3s ease}.btn-remove[_ngcontent-%COMP%]:hover:not(:disabled){background:#dc2626;transform:translateY(-1px)}.btn-remove[_ngcontent-%COMP%]:disabled{background:#cbd5e0;cursor:not-allowed}.help-text[_ngcontent-%COMP%]{color:#64748b;font-size:.85rem;margin-top:8px}.alert[_ngcontent-%COMP%]{padding:14px 16px;border-radius:8px;margin-bottom:20px;font-size:.9rem;border-left:4px solid;direction:rtl;text-align:right}.alert-error[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b;border-left-color:#dc2626}.alert-success[_ngcontent-%COMP%]{background:#dcfce7;color:#166534;border-left-color:#22c55e}.btn-submit[_ngcontent-%COMP%]{width:100%;padding:16px;background:linear-gradient(135deg,#ff6b35,#f7931e);color:#fff;border:none;border-radius:10px;font-size:1.05rem;font-weight:700;cursor:pointer;transition:all .3s ease;margin-top:10px}.btn-submit[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 10px 25px #ff6b354d}.btn-submit[_ngcontent-%COMP%]:disabled{background:#cbd5e0;cursor:not-allowed;transform:none}.table-wrapper[_ngcontent-%COMP%]{overflow-x:auto;margin-bottom:30px;border-radius:10px;box-shadow:0 2px 10px #0000000d}.results-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.9rem}.results-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1a1a2e,#16213e);color:#fff}.results-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:15px;text-align:left;font-weight:600;border:1px solid #e1e8ed}.results-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 15px;border:1px solid #e1e8ed;color:#2c3e50}.results-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background:#f8f9fa}.results-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#f0f5ff}.results-actions[_ngcontent-%COMP%]{display:flex;gap:15px;flex-wrap:wrap}.btn-restart[_ngcontent-%COMP%], .btn-home[_ngcontent-%COMP%]{flex:1;min-width:200px;padding:14px;border:none;border-radius:10px;font-size:1rem;font-weight:700;cursor:pointer;transition:all .3s ease}.btn-restart[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ff6b35,#f7931e);color:#fff}.btn-restart[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 10px 25px #ff6b354d}.btn-home[_ngcontent-%COMP%]{background:#e5e7eb;color:#2c3e50}.btn-home[_ngcontent-%COMP%]:hover{background:#d1d5db;transform:translateY(-2px)}@media (max-width: 768px){.upload-form-full-page[_ngcontent-%COMP%], .results-full-page[_ngcontent-%COMP%]{padding:15px}.form-container[_ngcontent-%COMP%], .results-container[_ngcontent-%COMP%]{padding:20px}.form-header[_ngcontent-%COMP%]{padding:30px 20px}.form-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}.form-body[_ngcontent-%COMP%]{padding:20px}.results-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}.results-table[_ngcontent-%COMP%]{font-size:.8rem}.results-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .results-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 8px}.results-actions[_ngcontent-%COMP%]{flex-direction:column}.btn-restart[_ngcontent-%COMP%], .btn-home[_ngcontent-%COMP%]{width:100%}}.alert-info[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:15px;border-radius:5px;margin-bottom:20px}.loading-inline[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px;font-size:16px}.spinner-small[_ngcontent-%COMP%]{border:3px solid rgba(255,255,255,.3);border-top:3px solid white;border-radius:50%;width:30px;height:30px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.form-control[_ngcontent-%COMP%]:disabled, .btn-submit[_ngcontent-%COMP%]:disabled, .btn-remove[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;background-color:#e0e0e0}.file-upload-wrapper.disabled[_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed;pointer-events:none}"]})};export{Y as UploadFileComponent};
